<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Panel Admin</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 20px;
  }
  .container {
    max-width: 1100px;
    margin: auto;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
  }
  .card {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }
  .grid input, .grid textarea {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    border: 1px solid #ddd;
    border-radius: 5px;
  }
  button {
    padding: 10px;
    border: none;
    border-radius: 5px;
    background: #1e40af;
    color: #fff;
    cursor: pointer;
    width: 100%;
    margin-top: 10px;
  }
  .product-list {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
  }
  .product-list img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 10px;
  }
  .product-list .card {
    text-align: center;
  }
  .product-list button {
    background: #e11d48;
  }
  .orders {
    margin-top: 20px;
  }
  .orders table {
    width: 100%;
    border-collapse: collapse;
  }
  .orders table th, .orders table td {
    padding: 10px;
    border: 1px solid #ddd;
    text-align: left;
  }
</style>
</head>
<body>
<div class="container">
  <h1>Panel Admin</h1>

  <!-- Add Product -->
  <div class="card">
    <h2>Ajouter un produit</h2>
    <div class="grid">
      <div>
        <label>Nom</label>
        <input type="text" id="name" placeholder="Nom du produit" />
      </div>
      <div>
        <label>Prix</label>
        <input type="text" id="price" placeholder="Prix" />
      </div>
      <div>
        <label>Image URL</label>
        <input type="text" id="image" placeholder="Lien de l'image" />
      </div>
      <div>
        <label>Description</label>
        <textarea id="description" rows="3" placeholder="Description"></textarea>
      </div>
    </div>
    <button onclick="addProduct()">Ajouter Produit</button>
  </div>

  <!-- Products List -->
  <div class="card">
    <h2>Liste des produits</h2>
    <div id="productsList" class="product-list"></div>
  </div>

  <!-- Orders -->
  <div class="card orders">
    <h2>Commandes</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Produit</th>
          <th>Prix</th>
          <th>Nom</th>
          <th>Téléphone</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody id="ordersList"></tbody>
    </table>
  </div>
</div>

<script>
async function loadProducts(){
  const res = await fetch("/products");
  const data = await res.json();
  const box = document.getElementById("productsList");
  box.innerHTML = "";

  data.forEach(p => {
    box.innerHTML += `
      <div class="card">
        <img src="${p.image}" alt="${p.name}">
        <strong>${p.name}</strong><br>
        <span>${p.price} GDS</span><br>
        <p>${p.description}</p>
        <button onclick="deleteProduct(${p.id})">Supprimer</button>
      </div>
    `;
  });
}

async function addProduct(){
  const name = document.getElementById("name").value;
  const price = document.getElementById("price").value;
  const image = document.getElementById("image").value;
  const description = document.getElementById("description").value;

  await fetch("/products", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, price, image, description })
  });

  loadProducts();
}

async function deleteProduct(id){
  await fetch(`/products/${id}`, {
    method: "DELETE"
  });

  loadProducts();
}

async function loadOrders(){
  const res = await fetch("/orders");
  const data = await res.json();
  const box = document.getElementById("ordersList");
  box.innerHTML = "";

  data.forEach(o => {
    box.innerHTML += `
      <tr>
        <td>${o.id}</td>
        <td>${o.productName}</td>
        <td>${o.price}</td>
        <td>${o.customerName}</td>
        <td>${o.phone}</td>
        <td>${o.date}</td>
      </tr>
    `;
  });
}

loadProducts();
loadOrders();
</script>
</body>
</html>
